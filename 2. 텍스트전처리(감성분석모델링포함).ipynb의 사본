{"cells":[{"cell_type":"markdown","source":["# 텍스트 전처리\n","- 전처리 기법 : 토큰화, 노이즈/불용어 제거, 통일화, 품사태깅, 벡터화\n","- 위의 전처리 기법이 실제 분석에서 어떻게 이루어지는지 파악하고 익혀보자"],"metadata":{"id":"3M7HH2eguzd0"}},{"cell_type":"markdown","source":["## konlpy 설치"],"metadata":{"id":"CBbN3NDBuzWE"}},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Jkb8AGo1IhzE","outputId":"a379d33f-944d-45e5-a7aa-11dc703a6885","executionInfo":{"status":"ok","timestamp":1667526253000,"user_tz":-540,"elapsed":14237,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting konlpy\n","  Downloading konlpy-0.6.0-py2.py3-none-any.whl (19.4 MB)\n","\u001b[K     |████████████████████████████████| 19.4 MB 1.2 MB/s \n","\u001b[?25hRequirement already satisfied: lxml>=4.1.0 in /usr/local/lib/python3.7/dist-packages (from konlpy) (4.9.1)\n","Collecting JPype1>=0.7.0\n","  Downloading JPype1-1.4.1-cp37-cp37m-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (465 kB)\n","\u001b[K     |████████████████████████████████| 465 kB 24.6 MB/s \n","\u001b[?25hRequirement already satisfied: numpy>=1.6 in /usr/local/lib/python3.7/dist-packages (from konlpy) (1.21.6)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from JPype1>=0.7.0->konlpy) (21.3)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from JPype1>=0.7.0->konlpy) (4.1.1)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->JPype1>=0.7.0->konlpy) (3.0.9)\n","Installing collected packages: JPype1, konlpy\n","Successfully installed JPype1-1.4.1 konlpy-0.6.0\n"]}],"source":["!pip install konlpy"]},{"cell_type":"code","source":["# 이미 앞서 다뤄본 적이 있는 기본적인 라이브러리\n","import numpy as np\n","import pandas as pd\n","\n","import json\n","import re\n","\n","from tqdm.notebook import tqdm"],"metadata":{"id":"zESgu8HdveVb","executionInfo":{"status":"ok","timestamp":1667526254341,"user_tz":-540,"elapsed":1355,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"execution_count":2,"outputs":[]},{"cell_type":"code","source":["from konlpy.tag import Okt # komoran, hannanum, kkma, mecab"],"metadata":{"id":"Kj8cUvjgwwen","executionInfo":{"status":"ok","timestamp":1667526255625,"user_tz":-540,"elapsed":3,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"execution_count":3,"outputs":[]},{"cell_type":"markdown","source":["#### 형태소 분석기별 메서드 정리 \n","출처 : https://konlpy-ko.readthedocs.io/ko/v0.4.3/\n","\n","---\n","1) Hannanum : KAIST에서 개발   \n","- analyze : 다양한 형태학적 후보를 반환\n","- morphs : 형태소 토큰화 \n","- nouns : 명사 토큰만 반환\n","- pos : 형태소에 품사 태깅하여 반환\n","---  \n","2) Kkma : 서울대에서 개발\n","- morphs : 형태소 토큰화 \n","- nouns : 명사 토큰만 반환\n","- pos : 형태소에 품사 태깅하여 반환 \n","- sentences : 문장 토큰화\n","---  \n","3) Komoran : Shineware팀에서 개발\n","- morphs : 형태소 토큰화 \n","- nouns : 명사 토큰만 반환\n","- pos : 형태소에 품사 태깅하여 반환\n","---\n","4) Mecab : 교토대에서 일본어용으로 개발된 분석기, 은전 프로젝트에 의해 한국어용 개발\n","- morphs : 형태소 토큰화 \n","- nouns : 명사 토큰만 반환\n","- pos : 형태소에 품사 태깅하여 반환\n","---\n","5) Okt(Twitter) : Will Hohyon Ryu가 개발\n","- morphs : 형태소 토큰화 \n","- nouns : 명사 토큰만 반환\n","- phrases : 다양한 형태학적 후보를 반환\n","- pos : 형태소에 품사 태깅하여 반환\n"],"metadata":{"id":"ISJjXt_MwwW7"}},{"cell_type":"code","execution_count":19,"metadata":{"id":"r5XeJCsSFRDv","executionInfo":{"status":"ok","timestamp":1667528590620,"user_tz":-540,"elapsed":6,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[],"source":["import os\n","from datetime import datetime"]},{"cell_type":"markdown","metadata":{"id":"Pob4fSi_2pk7"},"source":["## Download Dataset(github에서 NSMC 데이터셋 다운로드)"]},{"cell_type":"code","execution_count":20,"metadata":{"id":"STTcwzMlFQdv","executionInfo":{"status":"ok","timestamp":1667528592835,"user_tz":-540,"elapsed":1003,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[],"source":["train = pd.read_csv('https://raw.githubusercontent.com/e9t/nsmc/master/ratings_train.txt', header=0, delimiter='\\t' ,quoting=3)\n","test = pd.read_csv('https://raw.githubusercontent.com/e9t/nsmc/master/ratings_test.txt', header=0, delimiter='\\t' ,quoting=3)"]},{"cell_type":"code","execution_count":21,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"z9f6U7aSsmAX","outputId":"e548356e-9f3c-4b97-c062-3976e46ffa53","executionInfo":{"status":"ok","timestamp":1667528592836,"user_tz":-540,"elapsed":14,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["((150000, 3), (50000, 3))"]},"metadata":{},"execution_count":21}],"source":["train.shape, test.shape"]},{"cell_type":"code","execution_count":22,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":395},"id":"fCchRqrVspe7","outputId":"06d120aa-bab3-44c5-e35a-cbbc86dda2b9","executionInfo":{"status":"ok","timestamp":1667528592838,"user_tz":-540,"elapsed":13,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"display_data","data":{"text/plain":["         id                                           document  label\n","0   9976970                                아 더빙.. 진짜 짜증나네요 목소리      0\n","1   3819312                  흠...포스터보고 초딩영화줄....오버연기조차 가볍지 않구나      1\n","2  10265843                                  너무재밓었다그래서보는것을추천한다      0\n","3   9045019                      교도소 이야기구먼 ..솔직히 재미는 없다..평점 조정      0\n","4   6483659  사이몬페그의 익살스런 연기가 돋보였던 영화!스파이더맨에서 늙어보이기만 했던 커스틴 ...      1"],"text/html":["\n","  <div id=\"df-70003707-5fb1-4bca-a6f4-5c0dd8a179b8\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>document</th>\n","      <th>label</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>9976970</td>\n","      <td>아 더빙.. 진짜 짜증나네요 목소리</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>3819312</td>\n","      <td>흠...포스터보고 초딩영화줄....오버연기조차 가볍지 않구나</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>10265843</td>\n","      <td>너무재밓었다그래서보는것을추천한다</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>9045019</td>\n","      <td>교도소 이야기구먼 ..솔직히 재미는 없다..평점 조정</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>6483659</td>\n","      <td>사이몬페그의 익살스런 연기가 돋보였던 영화!스파이더맨에서 늙어보이기만 했던 커스틴 ...</td>\n","      <td>1</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-70003707-5fb1-4bca-a6f4-5c0dd8a179b8')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-70003707-5fb1-4bca-a6f4-5c0dd8a179b8 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-70003707-5fb1-4bca-a6f4-5c0dd8a179b8');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["        id                                           document  label\n","0  6270596                                                굳 ㅋ      1\n","1  9274899                               GDNTOPCLASSINTHECLUB      0\n","2  8544678             뭐야 이 평점들은.... 나쁘진 않지만 10점 짜리는 더더욱 아니잖아      0\n","3  6825595                   지루하지는 않은데 완전 막장임... 돈주고 보기에는....      0\n","4  6723715  3D만 아니었어도 별 다섯 개 줬을텐데.. 왜 3D로 나와서 제 심기를 불편하게 하죠??      0"],"text/html":["\n","  <div id=\"df-f8595a6a-52fe-4e98-89ac-123d39bc714c\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>document</th>\n","      <th>label</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>6270596</td>\n","      <td>굳 ㅋ</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>9274899</td>\n","      <td>GDNTOPCLASSINTHECLUB</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>8544678</td>\n","      <td>뭐야 이 평점들은.... 나쁘진 않지만 10점 짜리는 더더욱 아니잖아</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>6825595</td>\n","      <td>지루하지는 않은데 완전 막장임... 돈주고 보기에는....</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>6723715</td>\n","      <td>3D만 아니었어도 별 다섯 개 줬을텐데.. 왜 3D로 나와서 제 심기를 불편하게 하죠??</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f8595a6a-52fe-4e98-89ac-123d39bc714c')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-f8595a6a-52fe-4e98-89ac-123d39bc714c button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-f8595a6a-52fe-4e98-89ac-123d39bc714c');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{}}],"source":["display(train.head())\n","display(test.head())"]},{"cell_type":"code","execution_count":23,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"b-29Wn_Ps_Ff","outputId":"2c09d911-e62a-4ba9-b162-119b509a2eb8","executionInfo":{"status":"ok","timestamp":1667528594211,"user_tz":-540,"elapsed":6,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["id          0\n","document    5\n","label       0\n","dtype: int64"]},"metadata":{},"execution_count":23}],"source":["train.isnull().sum()"]},{"cell_type":"code","execution_count":24,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"aSWielg_tKTd","outputId":"89d89ad8-3783-431c-d62c-c2a61b1c1a5e","executionInfo":{"status":"ok","timestamp":1667528595440,"user_tz":-540,"elapsed":6,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["id          0\n","document    3\n","label       0\n","dtype: int64"]},"metadata":{},"execution_count":24}],"source":["test.isnull().sum()"]},{"cell_type":"code","execution_count":25,"metadata":{"id":"SKtctzPBF6eI","executionInfo":{"status":"ok","timestamp":1667528595807,"user_tz":-540,"elapsed":4,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[],"source":["train.dropna(inplace=True)\n","test.dropna(inplace=True)"]},{"cell_type":"code","execution_count":26,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7CssabwBFYFt","outputId":"97fbe7f8-1e36-45b7-dc28-c655c5926a4a","executionInfo":{"status":"ok","timestamp":1667528596143,"user_tz":-540,"elapsed":6,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["('아 더빙.. 진짜 짜증나네요 목소리', 0)"]},"metadata":{},"execution_count":26}],"source":["X_train = train.document   \n","y_train = train.label \n","\n","X_test = test.document  \n","y_test = test.label \n","X_train[0], y_train[0]"]},{"cell_type":"code","execution_count":27,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"1W1Ldm1GCPF1","outputId":"1db55896-ccaa-4c98-ba16-e6823037a16e","executionInfo":{"status":"ok","timestamp":1667528598174,"user_tz":-540,"elapsed":5,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["#Train set size: 149995\n","#Test set size: 49997\n"]}],"source":["print('#Train set size:', len(X_train))\n","print('#Test set size:', len(X_test))"]},{"cell_type":"markdown","metadata":{"id":"JKQ2lJ-L27Eg"},"source":["## 토큰화 + 노이즈/불용어제거 + 통일화 + 주요 품사 추출(품사태깅)"]},{"cell_type":"markdown","source":["### 토큰화"],"metadata":{"id":"cV-ZwoOiwauL"}},{"cell_type":"code","source":["review = X_train[0]"],"metadata":{"id":"kV9gRwTVw7IF","executionInfo":{"status":"ok","timestamp":1667528600700,"user_tz":-540,"elapsed":4,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"execution_count":28,"outputs":[]},{"cell_type":"code","source":["okt = Okt()"],"metadata":{"id":"LFM-QLkqxIlA","executionInfo":{"status":"ok","timestamp":1667528601157,"user_tz":-540,"elapsed":3,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"execution_count":29,"outputs":[]},{"cell_type":"code","source":["result = okt.morphs(review) \n","result"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"UZzqz7Jlw5iJ","executionInfo":{"status":"ok","timestamp":1667528610376,"user_tz":-540,"elapsed":8499,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"cad09e5f-f366-4f58-97f0-ed3d702b7453"},"execution_count":30,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['아', '더빙', '..', '진짜', '짜증나네요', '목소리']"]},"metadata":{},"execution_count":30}]},{"cell_type":"markdown","source":["### 노이즈 제거"],"metadata":{"id":"vHoFf-esxcE4"}},{"cell_type":"code","source":["# 한글제외한 나머지 문자 제거 --> 정규표현식\n","sub_noise = lambda text : re.sub('[^가-힣]', '', text)\n","result = [sub_noise(text) for text in result]\n","result"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0Lw9nbVQwaZK","executionInfo":{"status":"ok","timestamp":1667526163972,"user_tz":-540,"elapsed":17,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"3106defd-9d97-4e2f-9262-c2b8285ef1e8"},"execution_count":17,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['아', '더빙', '', '진짜', '짜증나네요', '목소리']"]},"metadata":{},"execution_count":17}]},{"cell_type":"code","source":["# 1글자짜리 제거 \n","result = [text for text in result if len(text) > 1]\n","result"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"eRyBU8JGy_Du","executionInfo":{"status":"ok","timestamp":1667526163973,"user_tz":-540,"elapsed":15,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"42315f05-7fd1-4eda-bf00-640a850e833b"},"execution_count":18,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['더빙', '진짜', '짜증나네요', '목소리']"]},"metadata":{},"execution_count":18}]},{"cell_type":"markdown","source":["### 불용어 제거"],"metadata":{"id":"TxAlCzn5zBoB"}},{"cell_type":"markdown","source":["# 불용어 사전 - 리스트로 사용\n","stopwords = ['목소리']\n","\n","with open('nsmc_stopwords.txt', 'wt') as f:\n","    f.write('\\n'.join(stopwords))  # 리스트 -> 문자열\n","\n","# f = open('nsmc_stopwords.txt', 'wt')\n","# f.write(stopwords_str)\n","# f.close()"],"metadata":{"id":"2cBeuLkkqMG8"}},{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"GRxJs8iNO-_N","outputId":"12e7597b-1ee1-4225-ff27-a3840e6e3e46","executionInfo":{"status":"ok","timestamp":1667526358475,"user_tz":-540,"elapsed":8,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["['교도소', '스파이더맨', '영화', '완전', '솔직히', '평점', '주다', '하다']"]},"metadata":{},"execution_count":10}],"source":["f = open('/content/nsmc_stopwords.txt') # 경로 + 파일명\n","stopwords = f.read().split()\n","stopwords"]},{"cell_type":"markdown","source":["파일의 경로 표현\n","- 절대경로 : 최상위경로부터 다 표현\n","- 상대경로 : 현재 실행파일 기준 상대적인 경로만 표현\n","- ./ : 현재 자기자신의 경로\n","- ../ : 한 단계 상위 경로"],"metadata":{"id":"2t9Snhi1UX9F"}},{"cell_type":"markdown","source":["result = [token for token in result if not token in stopwords]\n","result"],"metadata":{"id":"koax-L2I3f-W"}},{"cell_type":"markdown","source":["### 품사태깅"],"metadata":{"id":"KBThQ8agzWmH"}},{"cell_type":"code","source":["# 품사 태깅의 이해\n","review = X_train[0]\n","review"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":36},"id":"6Cl5mP2rxDuu","executionInfo":{"status":"ok","timestamp":1667528621740,"user_tz":-540,"elapsed":9,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"1c47d9a9-13f7-4f55-c9e0-ba7009bb36f3"},"execution_count":31,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'아 더빙.. 진짜 짜증나네요 목소리'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":31}]},{"cell_type":"code","source":["review_text = re.sub(\"[^가-힣\\\\s]\", \"\", review)\n","review_text"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":36},"id":"Xler52i4xdiK","executionInfo":{"status":"ok","timestamp":1667528625236,"user_tz":-540,"elapsed":9,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"0ff10555-b8d3-4140-f546-5ea1b8a74732"},"execution_count":32,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'아 더빙 진짜 짜증나네요 목소리'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":32}]},{"cell_type":"code","source":["okt = Okt()\n","word_review = okt.pos(review_text, stem=True)\n","word_review"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"DMeJxx77xI5L","executionInfo":{"status":"ok","timestamp":1667530600703,"user_tz":-540,"elapsed":493,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"8fd891e7-e0dd-454c-9842-6bed93385f5a"},"execution_count":89,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[('아', 'Exclamation'),\n"," ('더빙', 'Noun'),\n"," ('진짜', 'Noun'),\n"," ('짜증나다', 'Adjective'),\n"," ('목소리', 'Noun')]"]},"metadata":{},"execution_count":89}]},{"cell_type":"code","source":["word_review[1][0]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":36},"id":"pI7vo-Ftc7nI","executionInfo":{"status":"ok","timestamp":1667530601852,"user_tz":-540,"elapsed":4,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"07cc73be-cf56-4e17-92e5-71d92396da74"},"execution_count":90,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'더빙'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":90}]},{"cell_type":"code","source":["tokens = [word_review[i][0] for i in range(len(word_review))]\n","pos = [word_review[i][1] for i in range(len(word_review))]\n","print(tokens, pos)\n","\n","tokens, pos = [], []\n","for i in range(len(word_review)):\n","    tokens.append(word_review[i][0])\n","    pos.append(word_review[i][1])\n","print(tokens, pos)\n","type(tokens);type(pos)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"V4VAyrbQdEd5","executionInfo":{"status":"ok","timestamp":1667533558065,"user_tz":-540,"elapsed":304,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"dfa48436-294f-4a2f-e2aa-949fbe21af82"},"execution_count":121,"outputs":[{"output_type":"stream","name":"stdout","text":["['아', '더빙', '진짜', '짜증나다', '목소리'] ['Exclamation', 'Noun', 'Noun', 'Adjective', 'Noun']\n","['아', '더빙', '진짜', '짜증나다', '목소리'] ['Exclamation', 'Noun', 'Noun', 'Adjective', 'Noun']\n"]},{"output_type":"execute_result","data":{"text/plain":["list"]},"metadata":{},"execution_count":121}]},{"cell_type":"code","source":["for token, pos in word_review:\n","    print(token, pos)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"DcvhdvI4yIKz","executionInfo":{"status":"ok","timestamp":1667536165681,"user_tz":-540,"elapsed":4,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}},"outputId":"57ba5da1-8585-439e-be09-8c2d5c9bd51a"},"execution_count":123,"outputs":[{"output_type":"stream","name":"stdout","text":["아 Exclamation\n","더빙 Noun\n","진짜 Noun\n","짜증나다 Adjective\n","목소리 Noun\n"]},{"output_type":"execute_result","data":{"text/plain":["str"]},"metadata":{},"execution_count":123}]},{"cell_type":"markdown","source":["### 종합적인 구현"],"metadata":{"id":"WbIpJF-GzhND"}},{"cell_type":"code","execution_count":124,"metadata":{"id":"sDSGUJtEijtD","executionInfo":{"status":"ok","timestamp":1667536368756,"user_tz":-540,"elapsed":334,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[],"source":["def preprocessing(review): \n","    okt = Okt()\n","    \n","    f = open('nsmc_stopwords.txt')\n","    stop_words = f.read().split()\n","    \n","    # 1. 한글 및 공백을 제외한 문자 모두 제거.\n","    review_text = re.sub(\"[^가-힣\\\\s]\", \"\", review)\n","    \n","    # 2. okt 객체를 활용해서 형태소 토큰화 + 품사 태깅\n","    word_review = okt.pos(review_text, stem=True)\n","\n","    # 노이즈 & 불용어 제거\n","    word_review = [(token, pos) for token, pos in word_review if not token in stop_words and len(token) > 1]\n","    \n","    # 명사, 동사, 형용사 추출\n","    word_review = [token for token, pos in word_review if pos in ['Noun', 'Verb', 'Adjective']]\n","\n","    return word_review"]},{"cell_type":"code","execution_count":17,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":194},"id":"wgk-Q70_NWH_","outputId":"4b6ab35e-fab3-4e6a-b33f-b728f3f9ecda","executionInfo":{"status":"error","timestamp":1667528570436,"user_tz":-540,"elapsed":321,"user":{"displayName":"Sy Rhee","userId":"08018339085919910006"}}},"outputs":[{"output_type":"error","ename":"NameError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-17-c2c763bd15e5>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0;32mfor\u001b[0m \u001b[0mx\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mX_train\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;36m100\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mpreprocessing\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mNameError\u001b[0m: name 'X_train' is not defined"]}],"source":["for x in X_train[:100]:\n","    print(preprocessing(x))"]},{"cell_type":"markdown","source":["### 벡터화 \n","1. BoW : CountVectorizer\n","2. TF-IDF : TfidfVectorizer"],"metadata":{"id":"J-sLhthhzmBy"}},{"cell_type":"code","source":["from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer\n","from sklearn.linear_model import LogisticRegression\n","\n","# bow = CountVectorizer(tokenizer=preprocessing, min_df=5, max_df=0.5) \n","## df(documentary frequency) tf-idf의 df. min/max 모두 비율[0.0, 1.0]이나 정수로 할당 가능.\n","# tokenizer=preprocessing : 앞에서 정의한 preprocessing 함수를 tokenizer로 사용하겠다는 뜻\n","## tokenizer : 토큰 생성 함수 / default = none / analyzer, token_pattern 등을 사용할 수도 있음. \n","## 전처리 과정을 모두 거칠 것이기 때문에 함수를 할당. (날것 x-train을 넣으면 tokenizer까지 수행해라)\n","\n","# X_train_bow = bow.fit_transform(X_train) 리뷰\n","# X_test_bow = bow.transform(X_test)\n","## fit : 학습(feature-토큰을 뽑아내는 과정. 반드시 필요)\n","## transform : 학습을 한 결과(train)/학습할 대상(test)를 숫자로 변환(return)하는 과정."],"metadata":{"id":"BHfgIIqsCPWF"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["tfidf = TfidfVectorizer(tokenizer=preprocessing, max_features=2000, min_df=5, max_df=0.5) \n","\n","X_train_tfidf = tfidf.fit_transform(X_train)\n","X_test_tfidf = tfidf.transform(X_test)\n","\n","X_train_tfidf.toarray()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dE1WiFPUCSLE","executionInfo":{"status":"ok","timestamp":1667461323135,"user_tz":-540,"elapsed":489104,"user":{"displayName":"wonjae lee","userId":"02946067935890729436"}},"outputId":"6ce40cd5-d325-4fdb-df58-a97b916c0e78"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[0., 0., 0., ..., 0., 0., 0.],\n","       [0., 0., 0., ..., 0., 0., 0.],\n","       [0., 0., 0., ..., 0., 0., 0.],\n","       ...,\n","       [0., 0., 0., ..., 0., 0., 0.],\n","       [0., 0., 0., ..., 0., 0., 0.],\n","       [0., 0., 0., ..., 0., 0., 0.]])"]},"metadata":{},"execution_count":28}]},{"cell_type":"markdown","metadata":{"id":"39f8jyBhsvGs"},"source":["## 모델 학습 및 검증\n","- 현재 머신러닝 모델링에 대해 배운 것은 없지만,  \n","- 전처리된 데이터를 통해 여러 모델에 학습이 가능하다는 것을 확인하는 정도로 코드를 이해해보자."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"yxjCAlp3I0JM","outputId":"28c4b382-a32c-4f85-b300-8971930c8667","executionInfo":{"status":"ok","timestamp":1667461325840,"user_tz":-540,"elapsed":2734,"user":{"displayName":"wonjae lee","userId":"02946067935890729436"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Train set score: 0.816\n","Test set score: 0.809\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/sklearn/linear_model/_logistic.py:818: ConvergenceWarning: lbfgs failed to converge (status=1):\n","STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.\n","\n","Increase the number of iterations (max_iter) or scale the data as shown in:\n","    https://scikit-learn.org/stable/modules/preprocessing.html\n","Please also refer to the documentation for alternative solver options:\n","    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression\n","  extra_warning_msg=_LOGISTIC_SOLVER_CONVERGENCE_MSG,\n"]}],"source":["# 모델 1 : Logistic Regression 모형\n","from sklearn.linear_model import LogisticRegression\n","\n","log_clf = LogisticRegression()\n","log_clf.fit(X_train_tfidf, y_train)\n","print('Train set score: {:.3f}'.format(log_clf.score(X_train_tfidf, y_train)))\n","print('Test set score: {:.3f}'.format(log_clf.score(X_test_tfidf, y_test)))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"c2MQ9yOUCPF5","outputId":"bec94e71-0474-46bf-b95c-487ab681165c","executionInfo":{"status":"ok","timestamp":1667461351156,"user_tz":-540,"elapsed":25322,"user":{"displayName":"wonjae lee","userId":"02946067935890729436"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Train set score: 0.780\n","Test set score: 0.756\n"]}],"source":["# 모델 2 : 트리 앙상블 모형\n","## RandomForest : 임의의(Random) 서로 다른 결정트리들이 모인 숲(Forest)? / 확률모형(결정트리부터가)\n","from sklearn.ensemble import RandomForestClassifier\n","\n","model_rf = RandomForestClassifier(n_estimators = 100, max_depth=30, random_state = 0)\n","model_rf.fit(X_train_tfidf, y_train)\n","print('Train set score: {:.3f}'.format(model_rf.score(X_train_tfidf, y_train)))\n","print('Test set score: {:.3f}'.format(model_rf.score(X_test_tfidf, y_test)))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"FM2kQJauCPF5","outputId":"eefc7421-daa3-47f3-c3be-79d5245bfe3f","executionInfo":{"status":"ok","timestamp":1667461351157,"user_tz":-540,"elapsed":55,"user":{"displayName":"wonjae lee","userId":"02946067935890729436"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["Train set score: 0.807\n","Test set score: 0.801\n"]}],"source":["# 모델 3 : Naive Bayes 분류모형\n","## Bayes Theorem : 사건 전후의 확률관계를 나타낸 정리\n","from sklearn.naive_bayes import MultinomialNB\n","\n","NB_clf = MultinomialNB(alpha=0.1)\n","NB_clf.fit(X_train_tfidf, y_train)\n","print('Train set score: {:.3f}'.format(NB_clf.score(X_train_tfidf, y_train)))\n","print('Test set score: {:.3f}'.format(NB_clf.score(X_test_tfidf, y_test)))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"XrYdauMdCPF2","outputId":"f30ea234-759b-4d0f-9a9c-e15065021713","executionInfo":{"status":"ok","timestamp":1667461797042,"user_tz":-540,"elapsed":547,"user":{"displayName":"wonjae lee","userId":"02946067935890729436"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["(1, 1, '굳 ㅋ')\n","(0, 0, 'GDNTOPCLASSINTHECLUB')\n","(0, 1, '뭐야 이 평점들은.... 나쁘진 않지만 10점 짜리는 더더욱 아니잖아')\n","(0, 0, '지루하지는 않은데 완전 막장임... 돈주고 보기에는....')\n","(0, 0, '3D만 아니었어도 별 다섯 개 줬을텐데.. 왜 3D로 나와서 제 심기를 불편하게 하죠??')\n","(1, 1, '음악이 주가 된, 최고의 음악영화')\n","(0, 0, '진정한 쓰레기')\n","(0, 0, '마치 미국애니에서 튀어나온듯한 창의력없는 로봇디자인부터가,고개를 젖게한다')\n","(0, 0, '갈수록 개판되가는 중국영화 유치하고 내용없음 폼잡다 끝남 말도안되는 무기에 유치한cg남무 아 그립다 동사서독같은 영화가 이건 3류아류작이다')\n","(1, 1, '이별의 아픔뒤에 찾아오는 새로운 인연의 기쁨 But, 모든 사람이 그렇지는 않네..')\n"]}],"source":["clf = NB_clf\n","\n","for content in zip(y_test[:10], clf.predict(X_test_tfidf[:10]), X_test[:10]):\n","    print(content)"]},{"cell_type":"code","source":[],"metadata":{"id":"a-X4OWygd88a"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"collapsed_sections":[],"provenance":[{"file_id":"17WGRiSTDb4VTaSZTp98HlI4_K84Uen97","timestamp":1667526085074}]},"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.0"},"toc":{"base_numbering":1,"nav_menu":{},"number_sections":true,"sideBar":true,"skip_h1_title":false,"title_cell":"Table of Contents","title_sidebar":"Contents","toc_cell":true,"toc_position":{"height":"calc(100% - 180px)","left":"10px","top":"150px","width":"165px"},"toc_section_display":true,"toc_window_display":true},"varInspector":{"cols":{"lenName":16,"lenType":16,"lenVar":40},"kernels_config":{"python":{"delete_cmd_postfix":"","delete_cmd_prefix":"del ","library":"var_list.py","varRefreshCmd":"print(var_dic_list())"},"r":{"delete_cmd_postfix":") ","delete_cmd_prefix":"rm(","library":"var_list.r","varRefreshCmd":"cat(var_dic_list()) "}},"types_to_exclude":["module","function","builtin_function_or_method","instance","_Feature"],"window_display":false}},"nbformat":4,"nbformat_minor":0}